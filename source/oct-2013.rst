============
Octubre 2013
============

.. contents:: Tabla de Contenido

.. 01 de Octubre del 2013 - 5:00 p.m
.. ---------------------------------
.. ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
.. Problemas solventados en el día
.. ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
.. ~~~~~~~~~~~~~~~
.. Resumen del día
.. ~~~~~~~~~~~~~~~
.. ~~~~~~~~~~~~~~~~~~
.. Servers ejecutados
.. ~~~~~~~~~~~~~~~~~~
.. ~~~~~~~~~~~~~~~~~~~~~~~~~~~~
.. Problemas que se presentaron
.. ~~~~~~~~~~~~~~~~~~~~~~~~~~~~
.. trabajamos en delivery el 30 de sep, 1 de octubre y 2 de octubre

02 de Octubre del 2013 - 5:00 p.m
---------------------------------
~~~~~~~~~~~~~~~
Resumen del día
~~~~~~~~~~~~~~~

#) Módulo delivery_restaurant de los addons-vauxoo (tarea de cluster 141):

- Agregando los campos que necesito para hacer el filtrado. 

Se pide un filtro en el punto de venta que dependiendo del tipo de caja  (en el modelo pos.config 
existe un campo "deli_rest" que determina si la caja es para restaurante o delivery) se muestren  
los  productos que le corresponde, ya que los productos tienen dos campos booleanos (restaurant y 
delivery) que determinan si el producto se mostrara en cajas de delivery y/o restaurante.

Para ésto, se tuvo que heredar de la clase PosModel en el archivo models.js de punto de venta, 
donde se establece la data que se manejará en las funciones javascript, los campos  que se 
necesitaron de producto son "restaurant y delivery" y el campo del punto de venta 
(modelo pos.config)  "deli_rest".

``delivery_restaurant/__openerp__.py``
``Última modificación: 02/10/13 07:57, Estado: modificado, Tipo: archivo``

        ],
    'demo': [],
    'test': [],
    'js': [
        'static/src/js/backbone-super-min.js',
        'static/src/js/main.js',
        'static/src/js/models.js',
        ],
    'active': False,
    'installable': True,
}


``delivery_restaurant/static/src/js/main.js``
``Última modificación: 02/10/13 07:57, Estado: añadido, Tipo: archivo``

openerp.delivery_restaurant = function(instance){
    var module = instance.point_of_sale;
    delivery_restaurant_models(instance,module);
    instance.delivery_restaurant = module;
}


``delivery_restaurant/static/src/js/models.js``
``Última modificación: 02/10/13 07:42, Estado: añadido, Tipo: archivo``

function delivery_restaurant_models(instance, module){

    module.PosModel = module.PosModel.extend({
        initialize : function(session, attributes) {
            this._super(session, attributes);
        },
        
        load_server_data : function(){
            self = this;
            loaded = this._super()
                .then(function(){
                    return self.fetch(
                    'pos.config',
                    ['deli_rest'],
                    [['id','=', 
                    self.get('pos_session').config_id[0]]]
                    );
                }).then(function(){
                    return self.fetch(
                        'product.product', 
                        ['restaurant' , 'delivery'],
                        [['sale_ok','=',true],['available_in_pos','=',true]]
                        
                        );
                });
            return loaded;
        },

    })

}

.. note::
    Se debe tener en la carpeta js la librería backbone-super-min.js

#) 

01 de Octubre del 2013 - 5:00 p.m
---------------------------------
~~~~~~~~~~~~~~~
Resumen del día
~~~~~~~~~~~~~~~
#)
Ver como funciona el pos para poder hacer el filtrado de los productos
10:00 
2 horas

#)

Hoy aprendí sobre la herencia delegada, como por ejemplo en el módulo de product/product.py líne
536, en donde podemos observar que el modelo de product tiene una herencia delegada:  _inherits =
{'product.template': 'product_tmpl_id'}, y tiene product_tmpl_id como campo many2one a la clase de
product.template. En la tabla de product.product se pueden crear distintas formas de empaquetar a
un producto como por ejemplo por paleta, caja, paquete, etc. Pero a pesar de que se empaquetan de
manera distinta, de que tienen ean  distinto, entre otras cosas, comparten una información en común
y esa la encontraremos en el modulo de produtc.template, y de esa manera de evita repetir tanta
información.

#)

De modo que se agrego información al modulo product.product con dos booleanos por medio del nuevo
module delivery_restaurant, para saber si el producto se mostrará en el restaurant y/o en el
delivery. Tuve que hacer una consulta sql para poder agregar valores aleatorios a los registro yas
existentes:

    - update product_product set restaurant=true where id in (select id from product_product order by
    random() limit 100);
    - update product_product set delivery=true where id in (select id from product_product order by
      random() limit 100);

Esto hace que en la tabla product_product se modifique el campo restaurant o delivery a verdadero
en donde el id sea igual a los registros seleccionados aleatoriamente en la consulta despues de la
clausula IN.

#)

En el punto de venta estuve viendo como funciona la parte de ajvascript, y en el archivo models.js
línea 174, agregue los campos nuevos delivery y restaurant, para poder consultarlos luego en el
archivo widgets.js línea 576 

_.each(products, function(prod){                                                                                                    
     console.log(prod.name + "@@" +prod.restaurant);                                     
    }                                                                                   
); 

esta _.each función de underscore.js hace que a cada elemento de products lo reciba la función e imprima
la info que se desee.

~~~~~~~~~~~~~~~~~~
Servers ejecutados
~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Problemas que se presentaron
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
